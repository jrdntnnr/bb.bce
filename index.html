<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>The Eternal Bibi</title>
    <meta name="description" content="The Eternal Bibi">
    <link rel="stylesheet" type="text/css" href="main.css">
    <script src="https://aframe.io/releases/1.0.4/aframe.min.js"></script>
    <script src="https://unpkg.com/aframe-event-set-component@5/dist/aframe-event-set-component.min.js"></script>
    <script src="https://unpkg.com/aframe-layout-component@5.3.0/dist/aframe-layout-component.min.js"></script>
    <script src="https://unpkg.com/aframe-template-component@3.2.1/dist/aframe-template-component.min.js"></script>
    <script src="https://unpkg.com/aframe-proxy-event-component@2.1.0/dist/aframe-proxy-event-component.min.js"></script>
    <script src="https://wizgrav.github.io/aframe-effects/dist/aframe-effects.min.js"></script>
    <script src="//cdn.rawgit.com/donmccurdy/aframe-extras/v4.0.2/dist/aframe-extras.min.js"></script>
    <script src="audio-toggle.js"></script>
    <script src="https://unpkg.com/aframe-particle-system-component@1.0.9/dist/aframe-particle-system-component.min.js"></script>
    <script src="main.js"></script>
    <script src="aframe-animation-component.min.js"></script>

<body>

  <script type="script-effect" id="customFilter" data-defaults="tDiffuse 0.3 0.3 1." data-diffuse>
    void $main(inout vec4 c, vec4 o, vec2 uv, float d){
        float t = time * mix(1., 1000., abs(sin(time * 10. + uv.x)));
        uv = vec2(uv.x + resolution.z * sin(t * c.r + c.b), uv.y - resolution.w * cos(t * c.b + c.r));
        c.rgb += smoothstep(0.3, 0.9, texture2D($0,uv).rgb  ) * mix( $1, $2, abs(sin(time * $3))) ;
    }
</script>

<script type="script-effect" id="blendOutline" data-diffuse>
    void $main(inout vec4 c, vec4 o, vec2 uv, float d){
        c.rgb = mix(c.rgb, o.rgb, smoothstep(0.1,0.3,o.a));
    }
</script>

<script type="script-effect" id="add" data-defaults="bloom_texture bloom_intensity" data-diffuse>
    void $main(inout vec4 c, vec4 o, vec2 uv, float d){
        c.rgb += pow(texture2D($0, uv).rgb,vec3(2.)) * $1;
    }
</script>
  
<div id="splash">
<div class="loading"></div>
<div class="start-button">Start</div>
</div>

    <a-scene    
    antialias="false"
    effects=" colors, outline.sobel?, #blendOutline, bloom, film,  godrays, glitch,  fxaa"
    film="sIntensity: 0.03; nIntensity: 0.2" 
    outline="enabled: false; width: 1.33 1.33; range: 0 10; strength: 3; smooth: true;" 
    colors="mode:hqprtom; mul: 0.66 0.5 0.66; pow: 1 1.33 1.66; quant: 0.3 0.3 0.1; orig: 0.33 0.66 0.66"
    bloom="filter: bloom!, bloom.filter, #customFilter(bloom_texture 0.3 0.6 0.5); strength: 0.5; radius:1.2"
    fxaa="true"
    godrays="src: #sun; threshold: 0. 0.33; intensity: 2"
    glitch="false"
    >

      <a-assets>
        <img id="spajce" crossorigin="anonymous" src="spajce.jpg">
        <a-asset-item id="bibi" src="bibi-lo.glb"></a-asset-item>
        <a-asset-item id="crest" src="crest.glb"></a-asset-item>
        <a-asset-item id="photo" src="photo.glb"></a-asset-item>
        <a-asset-item id="pm" src="pm.glb"></a-asset-item>
        <audio id="loyihiye" src="loyihiye.mp3"></audio>
        <audio id="klum" src="Klum.mp3"></audio>
        <audio id="space" src="space.mp3"></audio>
      </a-assets>


      <a-entity light="type: ambient; color: #FFF; intensity: 2"></a-entity>
      <!-- <a-entity light="type: directional; color: #FFF; intensity: 2.6" position="-0.5 1 1"></a-entity> -->
      <a-entity sound="src: #space; loop:true; autoplay: true; volume:0.1; positional: false;"></a-entity>

      <!-- Bibi.1 -->
      <a-entity sound="src: #loyihiye; volume: 5; loop: false; on: mousedown" gltf-model="#bibi" position="0 0 -4" scale="0.4 0.4 0.4" rotation="0 -30 0" animation="property: position; to: 0 0.3 -4; dir: alternate; dur: 3000; easing: easeInOutQuad; loop: true" animation__2="property: rotation; to: 0 50 0; loop: true; dur: 20000; easing: linear; dir: alternate;"></a-entity>



      <!-- Crest -->
      <a-entity gltf-model="#crest" position="2.9 2.6 -5.3" scale="0.4 0.4 0.4s" rotation="25 0 0" animation="property: position; to: 2.9 2.8 -5.3; dir: alternate; dur: 4000; easing: easeInOutQuad; loop: true" animation__2="property: rotation; to: 0 -70 0; loop: true; dur: 30000; easing: linear; dir: alternate;"></a-entity>



      <!-- Photo -->
      <a-entity gltf-model="#photo" position="-4 -2.2 -2.3" scale="0.4 0.4 0.4s" rotation="0 -330 0" animation="property: position; to: -4 -2.7 -2.3; dir: alternate; dur: 3600; easing: easeInOutQuad; loop: true" animation__2="property: rotation; to: 0 -290 0; loop: true; dur: 30000; easing: linear; dir: alternate;"></a-entity>


      
      <!-- PM -->
      <a-entity gltf-model="#pm" position="0.471 2.325 -4" scale="0.4 0.4 0.4s" rotation="0 0 0"></a-entity>

      
      <!-- 360-degree image. -->

      <a-sky id="image-360" radius="10" src="#city" rotation="0 -90 0"
             animation__fade="property: components.material.material.color; type: color; from: #FFF; to: #000; dur: 300; startEvents: fade"
             animation__fadeback="property: components.material.material.color; type: color; from: #000; to: #FFF; dur: 300; startEvents: animationcomplete__fade"></a-sky>

      <a-sky id="image-360" radius="10" src="#spajce" rotation="0 -90 0"></a-sky>


      <!-- Particles. -->
      <a-entity particle-system="preset: dust; particleCount: 500; size: 0.1; opacity: 0.6; color: #f5f4b0; velocityValue: 0 0 -25" position="0 0 -5" scale="0.1 0.1 0.1" ></a-entity>

      <!-- Camera + cursor. -->
      <a-entity camera look-controls="pointerLockEnabled:
          true">
        <!-- <a-cursor
        cursor raycaster="far: infinity; fuse: true; fuseTimeout: 1; interval: 0" position="0 0 -0.3"
          geometry="primitive: ring; radiusInner: 0.003; radiusOuter: 0.005"
          material="color: #ff00ff"></a-cursor> -->
      </a-entity>
    </a-scene>
  </body>
</html>
<!--  -->
